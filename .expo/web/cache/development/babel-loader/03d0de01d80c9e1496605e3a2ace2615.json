{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Send from \"@expo/vector-icons/FontAwesome\";\nimport React, { useState, useContext, useEffect, useRef } from \"react\";\nimport { AuthContext } from \"./Context/useContext\";\nimport Conversation, { getMessages } from \"./Conversation\";\nimport { Route } from \"@react-navigation/native\";\nimport axios from \"axios\";\nimport { format } from \"timeago.js\";\nimport { io } from \"socket.io-client\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nvar Message = function Message(_ref) {\n  var route = _ref.route;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      msg = _useState2[0],\n      setMsg = _useState2[1];\n\n  var _useContext = useContext(AuthContext),\n      userId = _useContext.userId;\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      user = _useState4[0],\n      setUser = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      messages = _useState6[0],\n      setMessages = _useState6[1];\n\n  var _route$params = route.params,\n      conversationId = _route$params.conversationId,\n      friendId = _route$params.friendId;\n  var socket = useRef();\n  useEffect(function () {\n    socket.current = io(\"ws://localhost:3000\");\n    socket.current.on(\"getMessage\", function (data) {\n      setArrivalMessage({\n        sender: data.senderId,\n        text: data.text,\n        createdAt: Date.now()\n      });\n    });\n  }, []);\n\n  var getUser = function _callee() {\n    var res;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(axios(\"http://192.168.0.106:5000/api/profile/\" + friendId));\n\n          case 3:\n            res = _context.sent;\n            console.log(\"Response getting from USer\", res);\n            setUser(res.data.user);\n            _context.next = 11;\n            break;\n\n          case 8:\n            _context.prev = 8;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n\n          case 11:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  var getMessages = function _callee2() {\n    var res;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            console.log(\"conversationId\", conversationId);\n            _context2.prev = 1;\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(axios.get(\"http://192.168.0.106:5000/chat/getmessage/\" + conversationId));\n\n          case 4:\n            res = _context2.sent;\n            console.log(\"Response getting from Messsage\", res.data);\n            setMessages(res.data);\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](1);\n            console.log(_context2.t0);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 9]], Promise);\n  };\n\n  useEffect(function () {\n    getUser();\n    getMessages();\n  }, []);\n\n  var sendMsg = function sendMsg() {\n    axios.post(\"http://192.168.0.106:5000/chat/postmessage\", {\n      senderId: userId,\n      conversationId: conversationId,\n      text: msg\n    }).then(function (res) {\n      _jsx(Conversation, {\n        msg: msg\n      });\n\n      setMessages([].concat(_toConsumableArray(messages), [res.data]));\n      setMsg(\"\");\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n\n  return _jsxs(_Fragment, {\n    children: [_jsx(View, {\n      style: {\n        backgroundColor: \"#f1c40f\",\n        paddingVertical: 20\n      },\n      children: _jsx(Text, {\n        style: {\n          alignSelf: \"center\",\n          marginTop: 30,\n          fontSize: 20,\n          backgroundColor: \"#f1c40f\"\n        },\n        children: user.name\n      })\n    }), _jsx(FlatList, {\n      data: messages,\n      keyExtractor: function keyExtractor(key) {\n        return key._id;\n      },\n      renderItem: function renderItem(_ref2) {\n        var item = _ref2.item;\n        return _jsx(SafeAreaView, {\n          children: _jsxs(View, {\n            style: userId == item.senderId ? styles.CurrentUser : styles.User,\n            children: [_jsx(View, {\n              style: styles.message,\n              children: _jsx(Text, {\n                children: item.text\n              })\n            }), _jsx(Text, {\n              style: {\n                marginRight: 20\n              },\n              children: format(item.createdAt)\n            })]\n          })\n        });\n      }\n    }), _jsxs(View, {\n      style: {\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        marginVertical: 20,\n        position: \"relative\"\n      },\n      children: [_jsx(TextInput, {\n        placeholder: \"Enter a Mesage\",\n        value: msg,\n        onChangeText: function onChangeText(val) {\n          return setMsg(val);\n        },\n        style: {\n          borderWidth: 1,\n          borderColor: \"#000\",\n          padding: 7,\n          width: 350,\n          borderRadius: 15\n        }\n      }), _jsx(View, {\n        style: {\n          position: \"absolute\",\n          justifyContent: \"flex-end\"\n        },\n        children: _jsx(TouchableOpacity, {\n          onPress: function onPress() {\n            return sendMsg();\n          },\n          children: _jsx(Text, {\n            children: _jsx(Send, {\n              name: \"send\",\n              size: 25\n            })\n          })\n        })\n      })]\n    })]\n  });\n};\n\nvar styles = StyleSheet.create({\n  message: {\n    borderRadius: 20,\n    padding: 10,\n    borderWidth: 1,\n    borderColor: \"#000\",\n    width: 200\n  },\n  CurrentUser: {\n    justifyContent: \"flex-end\",\n    alignItems: \"flex-end\",\n    margin: 10\n  },\n  User: {\n    justifyContent: \"flex-start\",\n    alignItems: \"flex-start\",\n    margin: 10\n  }\n});\nexport default Message;","map":{"version":3,"names":["Send","React","useState","useContext","useEffect","useRef","AuthContext","Conversation","getMessages","Route","axios","format","io","Message","route","msg","setMsg","userId","user","setUser","messages","setMessages","params","conversationId","friendId","socket","current","on","data","setArrivalMessage","sender","senderId","text","createdAt","Date","now","getUser","res","console","log","get","sendMsg","post","then","catch","err","backgroundColor","paddingVertical","alignSelf","marginTop","fontSize","name","key","_id","item","styles","CurrentUser","User","message","marginRight","justifyContent","alignItems","marginVertical","position","val","borderWidth","borderColor","padding","width","borderRadius","StyleSheet","create","margin"],"sources":["I:/ReactNative/social_media-app/screens/Message.js"],"sourcesContent":["import {\r\n  FlatList,\r\n  SafeAreaView,\r\n  ScrollView,\r\n  StyleSheet,\r\n  Text,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\nimport Send from \"react-native-vector-icons/FontAwesome\";\r\nimport React, { useState, useContext, useEffect, useRef } from \"react\";\r\nimport { AuthContext } from \"./Context/useContext\";\r\nimport Conversation, { getMessages } from \"./Conversation\";\r\nimport { Route } from \"@react-navigation/native\";\r\nimport axios from \"axios\";\r\nimport { format } from \"timeago.js\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nconst Message = ({ route }) => {\r\n  const [msg, setMsg] = useState(\"\");\r\n  const { userId } = useContext(AuthContext);\r\n  const [user, setUser] = useState([]);\r\n  const [messages, setMessages] = useState([]);\r\n  const { conversationId, friendId } = route.params;\r\n  const socket = useRef();\r\n\r\n  useEffect(() => {\r\n    socket.current = io(\"ws://localhost:3000\");\r\n\r\n    socket.current.on(\"getMessage\", (data) => {\r\n      setArrivalMessage({\r\n        sender: data.senderId,\r\n        text: data.text,\r\n        createdAt: Date.now(),\r\n      });\r\n    });\r\n  }, []);\r\n\r\n  // socket.current.emit(\"sendMessage\", {\r\n  //   senderId: userId,\r\n  //   receiverId: friendId,\r\n  //   text: msg,\r\n  // });\r\n\r\n  const getUser = async () => {\r\n    try {\r\n      const res = await axios(\r\n        `http://192.168.0.106:5000/api/profile/${friendId}`\r\n      );\r\n      console.log(\"Response getting from USer\", res);\r\n      setUser(res.data.user);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  const getMessages = async () => {\r\n    console.log(\"conversationId\", conversationId);\r\n    try {\r\n      const res = await axios.get(\r\n        `http://192.168.0.106:5000/chat/getmessage/${conversationId}`\r\n      );\r\n      console.log(\"Response getting from Messsage\", res.data);\r\n      setMessages(res.data);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    getUser();\r\n    getMessages();\r\n  }, []);\r\n\r\n  const sendMsg = () => {\r\n    axios\r\n      .post(\"http://192.168.0.106:5000/chat/postmessage\", {\r\n        senderId: userId,\r\n        conversationId,\r\n        text: msg,\r\n      })\r\n      .then((res) => {\r\n        <Conversation msg={msg} />;\r\n        setMessages([...messages, res.data]);\r\n        setMsg(\"\");\r\n      })\r\n      .catch((err) => console.log(err));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <View style={{ backgroundColor: \"#f1c40f\", paddingVertical: 20 }}>\r\n        <Text\r\n          style={{\r\n            alignSelf: \"center\",\r\n            marginTop: 30,\r\n            fontSize: 20,\r\n            backgroundColor: \"#f1c40f\",\r\n          }}\r\n        >\r\n          {user.name}\r\n        </Text>\r\n      </View>\r\n\r\n      <FlatList\r\n        data={messages}\r\n        keyExtractor={(key) => key._id}\r\n        renderItem={({ item }) => {\r\n          return (\r\n            <SafeAreaView>\r\n              <View\r\n                style={\r\n                  userId == item.senderId ? styles.CurrentUser : styles.User\r\n                }\r\n              >\r\n                <View style={styles.message}>\r\n                  <Text>{item.text}</Text>\r\n                </View>\r\n                <Text style={{ marginRight: 20 }}>\r\n                  {format(item.createdAt)}\r\n                </Text>\r\n              </View>\r\n            </SafeAreaView>\r\n          );\r\n        }}\r\n      />\r\n\r\n      <View\r\n        style={{\r\n          justifyContent: \"center\",\r\n          alignItems: \"center\",\r\n          marginVertical: 20,\r\n          position: \"relative\",\r\n        }}\r\n      >\r\n        <TextInput\r\n          placeholder=\"Enter a Mesage\"\r\n          value={msg}\r\n          onChangeText={(val) => setMsg(val)}\r\n          style={{\r\n            borderWidth: 1,\r\n            borderColor: \"#000\",\r\n            padding: 7,\r\n            width: 350,\r\n            borderRadius: 15,\r\n          }}\r\n        />\r\n        <View style={{ position: \"absolute\", justifyContent: \"flex-end\" }}>\r\n          <TouchableOpacity onPress={() => sendMsg()}>\r\n            <Text>\r\n              <Send name=\"send\" size={25} />\r\n            </Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n    </>\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  message: {\r\n    borderRadius: 20,\r\n    padding: 10,\r\n    borderWidth: 1,\r\n    borderColor: \"#000\",\r\n    width: 200,\r\n  },\r\n  CurrentUser: {\r\n    justifyContent: \"flex-end\",\r\n    alignItems: \"flex-end\",\r\n    margin: 10,\r\n  },\r\n  User: {\r\n    justifyContent: \"flex-start\",\r\n    alignItems: \"flex-start\",\r\n    margin: 10,\r\n  },\r\n});\r\nexport default Message;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}